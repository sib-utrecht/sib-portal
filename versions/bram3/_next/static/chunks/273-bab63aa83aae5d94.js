(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{4562:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var n=r(6874);r(914);var o=r(9583),s=r(7586),a=r(9121);let i=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:r,size:s,asChild:l=!1,...u}=e,c=l?o.DX:"button";return(0,n.jsx)(c,{"data-slot":"button",className:(0,a.cn)(i({variant:r,size:s,className:t})),...u})}},6936:(e,t,r)=>{"use strict";r.d(t,{BT:()=>l,Wu:()=>u,ZB:()=>i,Zp:()=>s,aR:()=>a});var n=r(6874);r(914);var o=r(9121);function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,o.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function a(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,o.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,o.cn)("leading-none font-semibold",t),...r})}function l(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,o.cn)("text-muted-foreground text-sm",t),...r})}function u(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,o.cn)("px-6",t),...r})}},7941:(e,t,r)=>{"use strict";r.d(t,{A:()=>b,O:()=>E});var n=r(6874),o=r(914),s=r(2405),a=r(3825),i=r(1103),l=r(233),u=r(1564);let c=(0,o.createContext)(void 0),d={UserPoolId:u.env.NEXT_PUBLIC_COGNITO_USER_POOL_ID||"",ClientId:u.env.NEXT_PUBLIC_COGNITO_CLIENT_ID||""},g=u.env.NEXT_PUBLIC_AWS_REGION||"eu-central-1",v=e=>new s.NE({...d,Storage:e}),h=()=>v(S()),f=new a.k({region:g}),m=e=>{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(t.padEnd(t.length+(4-t.length%4)%4,"=")))},p=e=>{try{return(m(e)["cognito:groups"]||[]).includes("admins")}catch(e){return console.error("Failed to decode JWT:",e),!1}},I="cognito_jwt_token",w="cognito_refresh_token",x="cognito_username",_="cognito_token_expiry",k="cognito_keep_logged_in",S=()=>"true"===localStorage.getItem(k)?localStorage:sessionStorage;function E(e){let{children:t}=e,[r,a]=(0,o.useState)(!1),[u,g]=(0,o.useState)(!0),[E,b]=(0,o.useState)(null),[T,y]=(0,o.useState)(null),[C,P]=(0,o.useState)(!1),[R,N]=(0,o.useState)(null),A=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"true"===localStorage.getItem(k);b(e),a(!0),P(p(e)),localStorage.setItem(k,n.toString());let o=n?localStorage:sessionStorage;o.setItem(I,e),t&&o.setItem(w,t),r&&o.setItem(x,r);try{let t=m(e),r=1e3*t.exp;o.setItem(_,r.toString())}catch(e){console.error("Failed to parse token expiry:",e)}},U=()=>{b(null),a(!1),[localStorage,sessionStorage].forEach(e=>{e.removeItem(I),e.removeItem(w),e.removeItem(x),e.removeItem(_)}),localStorage.removeItem(k)},F=()=>{let e=S().getItem(_);return!!e&&parseInt(e,10)-Date.now()<3e5},O=async()=>{let e=S().getItem(w),t=S().getItem(x);if(!e||!t)return!1;try{var r;let n=h().getCurrentUser();if(n)return new Promise(e=>{n.getSession((t,r)=>{if(t||!r||!r.isValid()){U(),e(!1);return}let n=r.getIdToken().getJwtToken(),o=S();b(n),o.setItem(I,n);try{let e=m(n),t=1e3*e.exp;o.setItem(_,t.toString())}catch(e){console.error("Failed to parse token expiry:",e)}e(!0)})});let o=new i.l({ClientId:d.ClientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:{REFRESH_TOKEN:e}}),s=await f.send(o);if(null===(r=s.AuthenticationResult)||void 0===r?void 0:r.IdToken){let r=s.AuthenticationResult.IdToken;if(p(r))return A(r,s.AuthenticationResult.RefreshToken||e,t),!0}return U(),!1}catch(e){return console.error("Failed to refresh token:",e),U(),!1}};(0,o.useEffect)(()=>{(async()=>{let e=S().getItem(I);if(console.log("Restoring token"),e){if(F()){let e=await O();if(g(!1),e)return}else if(p(e)){b(e),a(!0),P(!0),g(!1);return}else{b(e),a(!0),g(!1);return}}let t=h().getCurrentUser();t?t.getSession((e,r)=>{if(e||!r){g(!1);return}if(r.isValid()){let e=r.getIdToken().getJwtToken();A(e,r.getRefreshToken().getToken(),t.getUsername()),P(p(e))}g(!1)}):g(!1)})()},[]),(0,o.useEffect)(()=>{if(!r)return;let e=setInterval(async()=>{F()&&await O()},6e4);return()=>clearInterval(e)},[r]);let L=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];y(null),g(!0);let n=r?localStorage:sessionStorage,o=new s.By({Username:e,Password:t}),a=new s.TU({Username:e,Pool:v(n),Storage:n});return new Promise((t,n)=>{a.authenticateUser(o,{onSuccess:n=>{A(n.getIdToken().getJwtToken(),n.getRefreshToken().getToken(),e,r),g(!1),t()},onFailure:e=>{y(e.message),g(!1),n(e)}})})},j=async e=>{y(null),g(!0);try{let t=new i.l({ClientId:d.ClientId,AuthFlow:"USER_AUTH",AuthParameters:{USERNAME:e,PREFERRED_CHALLENGE:"EMAIL_OTP"}}),r=await f.send(t);if(r.Session)N(r.Session),g(!1);else throw Error("Failed to initiate authentication")}catch(e){throw y(e instanceof Error?e.message:"Failed to send code"),g(!1),e}},B=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(y(null),g(!0),!R){y("No active session. Please request a code first."),g(!1);return}try{var n;let o=new l.$({ClientId:d.ClientId,ChallengeName:"EMAIL_OTP",Session:R,ChallengeResponses:{USERNAME:e,EMAIL_OTP_CODE:t}}),s=await f.send(o);if(null===(n=s.AuthenticationResult)||void 0===n?void 0:n.IdToken){let t=s.AuthenticationResult.IdToken,n=s.AuthenticationResult.RefreshToken;A(t,n,e,r),N(null),g(!1)}else throw Error("Failed to complete authentication")}catch(e){throw y(e instanceof Error?e.message:"Failed to verify code"),g(!1),e}},D=async e=>{y(null),g(!0);let t=new s.TU({Username:e,Pool:h()});return new Promise((e,r)=>{t.forgotPassword({inputVerificationCode:()=>{g(!1),e()},onSuccess:()=>{g(!1)},onFailure:e=>{y(e.message),g(!1),r(e)}})})},z=async(e,t,r)=>{y(null),g(!0);let n=new s.TU({Username:e,Pool:h()});return new Promise((e,o)=>{n.confirmPassword(t,r,{onSuccess:()=>{g(!1),e()},onFailure:e=>{y(e.message),g(!1),o(e)}})})};return(0,n.jsx)(c.Provider,{value:{isAuthenticated:r,isAdmin:C,isLoading:u,token:E,login:L,requestPasswordlessCode:j,loginWithCode:B,logout:()=>{let e=h().getCurrentUser();e&&e.signOut(),U()},error:T,resetPassword:D,confirmResetPassword:z},children:t})}function b(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8075:()=>{},9121:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var n=r(816),o=r(6357);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,n.$)(t))}}}]);