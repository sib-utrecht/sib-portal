(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1938:e=>{e.exports={style:{fontFamily:"'GeistSans', 'GeistSans Fallback'"},className:"__className_11fbf8",variable:"__variable_11fbf8"}},2714:e=>{e.exports={style:{fontFamily:"'GeistMono', ui-monospace, SFMono-Regular, Roboto Mono, Menlo, Monaco, Liberation Mono, DejaVu Sans Mono, Courier New, monospace"},className:"__className_dc33d3",variable:"__variable_dc33d3"}},5976:(e,t,n)=>{"use strict";n.d(t,{Providers:()=>s});var o=n(6874),r=n(7941);function s(e){let{children:t}=e;return(0,o.jsx)(r.O,{children:t})}},6033:(e,t,n)=>{"use strict";n.d(t,{ConvexClientProvider:()=>u});var o=n(6874),r=n(597),s=n(7941),l=n(914);let a=new r.eH("https://convex-portal.sib-utrecht.nl");function i(e){let{children:t}=e,{token:n}=(0,s.A)();return(0,l.useEffect)(()=>{n?a.setAuth(async()=>n):a.clearAuth()},[n]),(0,o.jsx)(o.Fragment,{children:t})}function u(e){let{children:t}=e;return(0,o.jsx)(r.hD,{client:a,children:(0,o.jsx)(s.O,{children:(0,o.jsx)(i,{children:t})})})}},6191:(e,t,n)=>{Promise.resolve().then(n.bind(n,6033)),Promise.resolve().then(n.bind(n,5976)),Promise.resolve().then(n.t.bind(n,1938,23)),Promise.resolve().then(n.t.bind(n,2714,23)),Promise.resolve().then(n.t.bind(n,6880,23))},6880:()=>{},7941:(e,t,n)=>{"use strict";n.d(t,{A:()=>C,O:()=>k});var o=n(6874),r=n(914),s=n(2405),l=n(3825),a=n(1103),i=n(233),u=n(1564);let c=(0,r.createContext)(void 0),d={UserPoolId:u.env.NEXT_PUBLIC_COGNITO_USER_POOL_ID||"",ClientId:u.env.NEXT_PUBLIC_COGNITO_CLIENT_ID||""},g=u.env.NEXT_PUBLIC_AWS_REGION||"eu-central-1",h=e=>new s.NE({...d,Storage:e}),m=()=>h(P()),f=new l.k({region:g}),_=e=>{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(t.padEnd(t.length+(4-t.length%4)%4,"=")))},I=e=>{try{return(_(e)["cognito:groups"]||[]).includes("admins")}catch(e){return console.error("Failed to decode JWT:",e),!1}},v="cognito_jwt_token",S="cognito_refresh_token",E="cognito_username",w="cognito_token_expiry",T="cognito_keep_logged_in",P=()=>"true"===localStorage.getItem(T)?localStorage:sessionStorage;function k(e){let{children:t}=e,[n,l]=(0,r.useState)(!1),[u,g]=(0,r.useState)(!0),[k,C]=(0,r.useState)(null),[p,R]=(0,r.useState)(null),[A,y]=(0,r.useState)(!1),[N,U]=(0,r.useState)(null),F=function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"true"===localStorage.getItem(T);C(e),l(!0),y(I(e)),localStorage.setItem(T,o.toString());let r=o?localStorage:sessionStorage;r.setItem(v,e),t&&r.setItem(S,t),n&&r.setItem(E,n);try{let t=_(e),n=1e3*t.exp;r.setItem(w,n.toString())}catch(e){console.error("Failed to parse token expiry:",e)}},O=()=>{C(null),l(!1),[localStorage,sessionStorage].forEach(e=>{e.removeItem(v),e.removeItem(S),e.removeItem(E),e.removeItem(w)}),localStorage.removeItem(T)},b=()=>{let e=P().getItem(w);return!!e&&parseInt(e,10)-Date.now()<3e5},x=async()=>{let e=P().getItem(S),t=P().getItem(E);if(!e||!t)return!1;try{var n;let o=m().getCurrentUser();if(o)return new Promise(e=>{o.getSession((t,n)=>{if(t||!n||!n.isValid()){O(),e(!1);return}let o=n.getIdToken().getJwtToken(),r=P();C(o),r.setItem(v,o);try{let e=_(o),t=1e3*e.exp;r.setItem(w,t.toString())}catch(e){console.error("Failed to parse token expiry:",e)}e(!0)})});let r=new a.l({ClientId:d.ClientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:{REFRESH_TOKEN:e}}),s=await f.send(r);if(null===(n=s.AuthenticationResult)||void 0===n?void 0:n.IdToken){let n=s.AuthenticationResult.IdToken;if(I(n))return F(n,s.AuthenticationResult.RefreshToken||e,t),!0}return O(),!1}catch(e){return console.error("Failed to refresh token:",e),O(),!1}};(0,r.useEffect)(()=>{(async()=>{let e=P().getItem(v);if(console.log("Restoring token"),e){if(b()){let e=await x();if(g(!1),e)return}else if(I(e)){C(e),l(!0),y(!0),g(!1);return}else{C(e),l(!0),g(!1);return}}let t=m().getCurrentUser();t?t.getSession((e,n)=>{if(e||!n){g(!1);return}if(n.isValid()){let e=n.getIdToken().getJwtToken();F(e,n.getRefreshToken().getToken(),t.getUsername()),y(I(e))}g(!1)}):g(!1)})()},[]),(0,r.useEffect)(()=>{if(!n)return;let e=setInterval(async()=>{b()&&await x()},6e4);return()=>clearInterval(e)},[n]);let M=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];R(null),g(!0);let o=n?localStorage:sessionStorage,r=new s.By({Username:e,Password:t}),l=new s.TU({Username:e,Pool:h(o),Storage:o});return new Promise((t,o)=>{l.authenticateUser(r,{onSuccess:o=>{F(o.getIdToken().getJwtToken(),o.getRefreshToken().getToken(),e,n),g(!1),t()},onFailure:e=>{R(e.message),g(!1),o(e)}})})},L=async e=>{R(null),g(!0);try{let t=new a.l({ClientId:d.ClientId,AuthFlow:"USER_AUTH",AuthParameters:{USERNAME:e,PREFERRED_CHALLENGE:"EMAIL_OTP"}}),n=await f.send(t);if(n.Session)U(n.Session),g(!1);else throw Error("Failed to initiate authentication")}catch(e){throw R(e instanceof Error?e.message:"Failed to send code"),g(!1),e}},j=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(R(null),g(!0),!N){R("No active session. Please request a code first."),g(!1);return}try{var o;let r=new i.$({ClientId:d.ClientId,ChallengeName:"EMAIL_OTP",Session:N,ChallengeResponses:{USERNAME:e,EMAIL_OTP_CODE:t}}),s=await f.send(r);if(null===(o=s.AuthenticationResult)||void 0===o?void 0:o.IdToken){let t=s.AuthenticationResult.IdToken,o=s.AuthenticationResult.RefreshToken;F(t,o,e,n),U(null),g(!1)}else throw Error("Failed to complete authentication")}catch(e){throw R(e instanceof Error?e.message:"Failed to verify code"),g(!1),e}},D=async e=>{R(null),g(!0);let t=new s.TU({Username:e,Pool:m()});return new Promise((e,n)=>{t.forgotPassword({inputVerificationCode:()=>{g(!1),e()},onSuccess:()=>{g(!1)},onFailure:e=>{R(e.message),g(!1),n(e)}})})},G=async(e,t,n)=>{R(null),g(!0);let o=new s.TU({Username:e,Pool:m()});return new Promise((e,r)=>{o.confirmPassword(t,n,{onSuccess:()=>{g(!1),e()},onFailure:e=>{R(e.message),g(!1),r(e)}})})};return(0,o.jsx)(c.Provider,{value:{isAuthenticated:n,isAdmin:A,isLoading:u,token:k,login:M,requestPasswordlessCode:L,loginWithCode:j,logout:()=>{let e=m().getCurrentUser();e&&e.signOut(),O()},error:p,resetPassword:D,confirmResetPassword:G},children:t})}function C(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8075:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[713,819,597,679,217,358],()=>t(6191)),_N_E=e.O()}]);